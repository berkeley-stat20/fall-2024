<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Overfitting – Stat 20</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../assets/stat20-hex.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-018089954d508eae8a473f0b7f0491f0.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-7b6855b20a600ea9b2bbb9bbd6e9f584.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="../../site_libs/quarto-contrib/stat20notes-1.0.0/stat20notes.js"></script>
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-WP7F4QKDC8"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-WP7F4QKDC8', { 'anonymize_ip': true});
</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../site_libs/quarto-contrib/quarto-project/stat20/stat20notes/sidebar.css">
<meta property="og:title" content="Overfitting – Stat 20">
<meta property="og:description" content="Training sets and testing sets">
<meta property="og:image" content="https://stat20.berkeley.edu/fall-2024/5-prediction/03-overfitting/images/poly.png">
<meta property="og:site_name" content="Stat 20">
<meta property="og:image:height" content="972">
<meta property="og:image:width" content="1354">
<meta name="twitter:title" content="Overfitting – Stat 20">
<meta name="twitter:description" content="Training sets and testing sets">
<meta name="twitter:image" content="https://stat20.berkeley.edu/fall-2024/5-prediction/03-overfitting/images/poly.png">
<meta name="twitter:image-height" content="972">
<meta name="twitter:image-width" content="1354">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-sm " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../assets/stat20-hex-small.png" alt="Stat 20 logo" class="navbar-logo">
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../syllabus.html"> 
<span class="menu-text">Syllabus</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../office-hours.html"> 
<span class="menu-text">Office Hours</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../notes.html"> 
<span class="menu-text">Notes</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../assignments.html"> 
<span class="menu-text">Assignments</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../tutorials.html"> 
<span class="menu-text">Tutorials</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools tools-wide">
    <a href="https://edstem.org/" title="" class="quarto-navigation-tool px-1" aria-label="Ed Discussion Forum"><i class="bi bi-chat-fill"></i></a>
    <a href="https://www.gradescope.com/" title="" class="quarto-navigation-tool px-1" aria-label="Gradescope"><i class="bi bi-bar-chart-fill"></i></a>
    <a href="https://stat20.datahub.berkeley.edu/" title="" class="quarto-navigation-tool px-1" aria-label="RStudio"><i class="bi bi-r-circle-fill"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#overfitting-with-polynomials" id="toc-overfitting-with-polynomials" class="nav-link active" data-scroll-target="#overfitting-with-polynomials">Overfitting with polynomials</a></li>
  <li><a href="#training-and-testing-sets-a-workflow-to-curb-overfitting" id="toc-training-and-testing-sets-a-workflow-to-curb-overfitting" class="nav-link" data-scroll-target="#training-and-testing-sets-a-workflow-to-curb-overfitting">Training and testing sets: a workflow to curb overfitting</a>
  <ul class="collapse">
  <li><a href="#more-on-splitting-the-data" id="toc-more-on-splitting-the-data" class="nav-link" data-scroll-target="#more-on-splitting-the-data">More on splitting the data</a></li>
  <li><a href="#mean-square-error-another-metric-for-evaluation" id="toc-mean-square-error-another-metric-for-evaluation" class="nav-link" data-scroll-target="#mean-square-error-another-metric-for-evaluation">Mean square error: another metric for evaluation</a></li>
  </ul></li>
  <li><a href="#the-ideas-in-code" id="toc-the-ideas-in-code" class="nav-link" data-scroll-target="#the-ideas-in-code">The Ideas in Code</a>
  <ul class="collapse">
  <li><a href="#step-1-split-data" id="toc-step-1-split-data" class="nav-link" data-scroll-target="#step-1-split-data">Step 1: Split data</a></li>
  <li><a href="#step-2-fit-the-model-to-the-training-set" id="toc-step-2-fit-the-model-to-the-training-set" class="nav-link" data-scroll-target="#step-2-fit-the-model-to-the-training-set">Step 2: Fit the model to the training set</a></li>
  <li><a href="#step-3-evaluate-the-model-on-the-testing-set." id="toc-step-3-evaluate-the-model-on-the-testing-set." class="nav-link" data-scroll-target="#step-3-evaluate-the-model-on-the-testing-set.">Step 3: Evaluate the model on the testing set.</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul>
<div class="quarto-other-links"><h2>Other Links</h2><ul><li><a href="slides.html"><i class="bi bi-file-slides-fill"></i>Slides</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Overfitting</h1>
<p class="subtitle lead">Training sets and testing sets</p>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<!---
Before reading these notes, take a listen to Act 3 of an episode of the podcast "This American Life" called "Kids Look Back" (10 minutes).

[This American Life: Kids Look Back](https://www.thisamericanlife.org/584/for-your-reconsideration)



---
-->
<p><span class="dropcap">B</span>elow is data we collected about the association between number of hours studied and students’ test scores in a math class. Our goal is to predict the exam score from number of hours studied. Both plots below show the same data, but show the predictions from two different predictive models.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="notes_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Which model looks more appropriate: the blue, or the red? More specifically,</p>
<ul>
<li><p>Does it make sense that there should be a big difference between studying 6.7 hours vs studying 6.8 hours?</p></li>
<li><p>Should studying a little more make your score go down?</p></li>
</ul>
<p>The blue model seems more reasonable: studying more should steadily increase your score. The predictive model on the right seems like it took the particular data points “too seriously!” This will be an issue if a new set of students from the same class comes along and we want to predict what their exam scores will be based on the amount of hours studied. Let’s use the blue and red models to predict scores from more students from this same class.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="notes_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We see that the blue line is prepared to predict the exam scores well enough for these students–even though the model was not fit using them! The red model, however, does poorly. It is so beholden to the first group of students that it doesn’t know how to manage when the students are even slightly different. In statistics, we say that the red model was <strong>overfit</strong>.</p>
<dl>
<dt><strong>Overfitting</strong></dt>
<dd>
The practice of using a predictive model which is very effective at explaining the data used to fit it, but is poor at making predictions on <em>new</em> data.
</dd>
</dl>
<!---
## Defining overfitting

Learning through examples is one of the most important ways we acquire knowledge.
Almost all predictive modeling -- from linear regression to artificial intelligence based on deep learning -- is accomplished though learning by example. 

In simple linear regression we show our model a bunch of pairs of examples $(x_1, y_1), \dots, (x_n, y_n)$ and ask the linear model to best approximate $y$ through the linear function $\widehat{y} = b_0 + b_1 \cdot x$. The "lesson" that the model learns are the values of $b_0$ and $b_1$ that define the relationship between the variables $x$ and $y$ (and those coefficient values are composed of nothing more than the original observations[^slr]).

[^trees]: Definition (Merriam-Webster): to not understand or appreciate a larger situation, problem, etc., because one is considering only a few parts of it.


https://www.merriam-webster.com/dictionary/miss%20the%20forest%20for%20the%20trees#:~:text=Definition%20of%20miss%20the%20forest,a%20few%20parts%20of%20it 


[^slr]: Recall $b_1 = r \frac{s_y}{s_x}$ and each of the statistics involved are functions of $x_i, y_i$ and $n$).

Have you ever given someone an example to illustrate a concept, but that person gets too caught up in the details of the example and learns the wrong lesson? There is an expression for this: "missing the forest for the trees"[^trees].
Missing the forest for the trees turns out to be one of the most important concepts predictive modeling. In statistics, we call it *overfitting*.

**Overfitting**
:    The practice of using a predictive model which is very effective at explaining the data used to fit it, but is poor at making predictions on *new* data. 
-->
<section id="overfitting-with-polynomials" class="level2">
<h2 class="anchored" data-anchor-id="overfitting-with-polynomials">Overfitting with polynomials</h2>
<p>Usually, overfitting occurs as a result of applying a model that is too complex, like the red one we saw for the math class data above. We created that overfitted predictive model on the right by fitting a polynomial with a high degree. Polynomials are quite powerful models and are capable of creating very complex predictive functions. The higher the polynomial degree, the more complex function it can create.</p>
<p>Let’s illustrate by fitting polynomial models with progressively higher degrees to the data set above.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="notes_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<p>The higher the polynomial degree, the closer the prediction function comes to perfectly fitting the data<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>. Therefore, when it comes to evaluating which model is the best for prediction, we would say the degree seven polynomial is best. Indeed, based on our knowledge so far, it would have the highest <span class="math inline">\(R^2\)</span>. The true test is yet to come, though. Let’s measure these three models on how well they predict to the second group of students that weren’t used to fit the model.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="notes_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<p>As we increase the degree, the polynomial begins to perform worse on this new data as it bends to conform to the original data. For example, we see that for the student having studied around five and a half hours, the fifth degree polynomial does well, but the seven degree polynomial does horribly! To put a cherry on top, the red model we showed you in the beginnng of these notes was a <em>twenty</em> degree polynomial!</p>
<p>What we see is that the higher the degree, the more risk we run of using a model that overfits.</p>
</section>
<section id="training-and-testing-sets-a-workflow-to-curb-overfitting" class="level2">
<h2 class="anchored" data-anchor-id="training-and-testing-sets-a-workflow-to-curb-overfitting">Training and testing sets: a workflow to curb overfitting</h2>
<p>What you should have taken away so far is the following: <em>we should not fit the model (set the <span class="math inline">\(b_0, b_1\)</span> coefficients) and evaluate the model (judge its predictive power) with the same data set!</em></p>
<p>We can further back up this idea quantitatively. The plot below shows the <span class="math inline">\(R^2\)</span> value for math class models fit with different polynomial degrees.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="notes_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
<p>The <span class="math inline">\(R^2\)</span> value goes steadily upwards as the polynomial degree goes up. In fact this is mathematically guaranteed to happen: <em>for a fixed data set the <span class="math inline">\(R^2\)</span> value for a polynomial model with higher degree will always be higher than a polynomial model with lower degree.</em></p>
<p>This should be disconcerting, especially since we earlier saw that the model with the highest <span class="math inline">\(R^2\)</span> did the worst on our unseen data. What you might also notice is that the <span class="math inline">\(R^2\)</span> isn’t increasing by that much between degrees as the degree gets higher. This suggests that adding that additional degree isn’t improving our <em>general</em> predictive power much; it’s just helping the model tailor itself to the <em>specific</em> data we have.</p>
<p>Does that mean <span class="math inline">\(R^2\)</span> is not a good metric to evaluate our model? Not necessarily. We can just change our workflow slightly. Instead of thinking in terms of a single data set, we can <em>partition</em>, or split the observations of the data set into two separate sets. We can use one of these data sets to <em>fit</em> the model, and the other to <em>evaluate</em> it.</p>
<dl>
<dt><strong>Training Set</strong></dt>
<dd>
The set of observations used to fit a predictive model; i.e.&nbsp;estimate the model coefficients.
</dd>
<dt><strong>Testing Set</strong></dt>
<dd>
The set of observations used to assess the accuracy of a predictive model. This set is disjoint from the training set.
</dd>
</dl>
<p>The partition of a data frame into training and testing sets is illustrated by the diagram below.</p>
<div class="cell">
<div class="cell-output-display">
<div id="smgplnjbus" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#smgplnjbus table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#smgplnjbus thead, #smgplnjbus tbody, #smgplnjbus tfoot, #smgplnjbus tr, #smgplnjbus td, #smgplnjbus th {
  border-style: none;
}

#smgplnjbus p {
  margin: 0;
  padding: 0;
}

#smgplnjbus .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#smgplnjbus .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#smgplnjbus .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#smgplnjbus .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#smgplnjbus .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#smgplnjbus .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#smgplnjbus .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#smgplnjbus .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#smgplnjbus .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#smgplnjbus .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#smgplnjbus .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#smgplnjbus .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#smgplnjbus .gt_spanner_row {
  border-bottom-style: hidden;
}

#smgplnjbus .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#smgplnjbus .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#smgplnjbus .gt_from_md > :first-child {
  margin-top: 0;
}

#smgplnjbus .gt_from_md > :last-child {
  margin-bottom: 0;
}

#smgplnjbus .gt_row {
  padding-top: 7px;
  padding-bottom: 7px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#smgplnjbus .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#smgplnjbus .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#smgplnjbus .gt_row_group_first td {
  border-top-width: 2px;
}

#smgplnjbus .gt_row_group_first th {
  border-top-width: 2px;
}

#smgplnjbus .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#smgplnjbus .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#smgplnjbus .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#smgplnjbus .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#smgplnjbus .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#smgplnjbus .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#smgplnjbus .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#smgplnjbus .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#smgplnjbus .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#smgplnjbus .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#smgplnjbus .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#smgplnjbus .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#smgplnjbus .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#smgplnjbus .gt_left {
  text-align: left;
}

#smgplnjbus .gt_center {
  text-align: center;
}

#smgplnjbus .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#smgplnjbus .gt_font_normal {
  font-weight: normal;
}

#smgplnjbus .gt_font_bold {
  font-weight: bold;
}

#smgplnjbus .gt_font_italic {
  font-style: italic;
}

#smgplnjbus .gt_super {
  font-size: 65%;
}

#smgplnjbus .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#smgplnjbus .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#smgplnjbus .gt_indent_1 {
  text-indent: 5px;
}

#smgplnjbus .gt_indent_2 {
  text-indent: 10px;
}

#smgplnjbus .gt_indent_3 {
  text-indent: 15px;
}

#smgplnjbus .gt_indent_4 {
  text-indent: 20px;
}

#smgplnjbus .gt_indent_5 {
  text-indent: 25px;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="gt_col_headings header">
<th id="y" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">y</th>
<th id="x1" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">x1</th>
<th id="x2" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">x2</th>
<th id="x3" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">x3</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_right" headers="y" style="background-color: #4682B4; border-left-width: 1px; border-left-style: solid; border-left-color: #000000; border-right-width: 1px; border-right-style: solid; border-right-color: #000000"></td>
<td class="gt_row gt_right" headers="x1" style="background-color: #4682B4; border-left-width: 1px; border-left-style: solid; border-left-color: #000000; border-right-width: 1px; border-right-style: solid; border-right-color: #000000"></td>
<td class="gt_row gt_right" headers="x2" style="background-color: #4682B4; border-left-width: 1px; border-left-style: solid; border-left-color: #000000; border-right-width: 1px; border-right-style: solid; border-right-color: #000000"></td>
<td class="gt_row gt_right" headers="x3" style="background-color: #4682B4; border-left-width: 1px; border-left-style: solid; border-left-color: #000000; border-right-width: 1px; border-right-style: solid; border-right-color: #000000"></td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="y" style="background-color: #DAA520; border-left-width: 1px; border-left-style: solid; border-left-color: #000000; border-right-width: 1px; border-right-style: solid; border-right-color: #000000"></td>
<td class="gt_row gt_right" headers="x1" style="background-color: #DAA520; border-left-width: 1px; border-left-style: solid; border-left-color: #000000; border-right-width: 1px; border-right-style: solid; border-right-color: #000000"></td>
<td class="gt_row gt_right" headers="x2" style="background-color: #DAA520; border-left-width: 1px; border-left-style: solid; border-left-color: #000000; border-right-width: 1px; border-right-style: solid; border-right-color: #000000"></td>
<td class="gt_row gt_right" headers="x3" style="background-color: #DAA520; border-left-width: 1px; border-left-style: solid; border-left-color: #000000; border-right-width: 1px; border-right-style: solid; border-right-color: #000000"></td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="y" style="background-color: #4682B4; border-left-width: 1px; border-left-style: solid; border-left-color: #000000; border-right-width: 1px; border-right-style: solid; border-right-color: #000000"></td>
<td class="gt_row gt_right" headers="x1" style="background-color: #4682B4; border-left-width: 1px; border-left-style: solid; border-left-color: #000000; border-right-width: 1px; border-right-style: solid; border-right-color: #000000"></td>
<td class="gt_row gt_right" headers="x2" style="background-color: #4682B4; border-left-width: 1px; border-left-style: solid; border-left-color: #000000; border-right-width: 1px; border-right-style: solid; border-right-color: #000000"></td>
<td class="gt_row gt_right" headers="x3" style="background-color: #4682B4; border-left-width: 1px; border-left-style: solid; border-left-color: #000000; border-right-width: 1px; border-right-style: solid; border-right-color: #000000"></td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="y" style="background-color: #4682B4; border-left-width: 1px; border-left-style: solid; border-left-color: #000000; border-right-width: 1px; border-right-style: solid; border-right-color: #000000"></td>
<td class="gt_row gt_right" headers="x1" style="background-color: #4682B4; border-left-width: 1px; border-left-style: solid; border-left-color: #000000; border-right-width: 1px; border-right-style: solid; border-right-color: #000000"></td>
<td class="gt_row gt_right" headers="x2" style="background-color: #4682B4; border-left-width: 1px; border-left-style: solid; border-left-color: #000000; border-right-width: 1px; border-right-style: solid; border-right-color: #000000"></td>
<td class="gt_row gt_right" headers="x3" style="background-color: #4682B4; border-left-width: 1px; border-left-style: solid; border-left-color: #000000; border-right-width: 1px; border-right-style: solid; border-right-color: #000000"></td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="y" style="background-color: #4682B4; border-left-width: 1px; border-left-style: solid; border-left-color: #000000; border-right-width: 1px; border-right-style: solid; border-right-color: #000000"></td>
<td class="gt_row gt_right" headers="x1" style="background-color: #4682B4; border-left-width: 1px; border-left-style: solid; border-left-color: #000000; border-right-width: 1px; border-right-style: solid; border-right-color: #000000"></td>
<td class="gt_row gt_right" headers="x2" style="background-color: #4682B4; border-left-width: 1px; border-left-style: solid; border-left-color: #000000; border-right-width: 1px; border-right-style: solid; border-right-color: #000000"></td>
<td class="gt_row gt_right" headers="x3" style="background-color: #4682B4; border-left-width: 1px; border-left-style: solid; border-left-color: #000000; border-right-width: 1px; border-right-style: solid; border-right-color: #000000"></td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="y" style="background-color: #DAA520; border-left-width: 1px; border-left-style: solid; border-left-color: #000000; border-right-width: 1px; border-right-style: solid; border-right-color: #000000"></td>
<td class="gt_row gt_right" headers="x1" style="background-color: #DAA520; border-left-width: 1px; border-left-style: solid; border-left-color: #000000; border-right-width: 1px; border-right-style: solid; border-right-color: #000000"></td>
<td class="gt_row gt_right" headers="x2" style="background-color: #DAA520; border-left-width: 1px; border-left-style: solid; border-left-color: #000000; border-right-width: 1px; border-right-style: solid; border-right-color: #000000"></td>
<td class="gt_row gt_right" headers="x3" style="background-color: #DAA520; border-left-width: 1px; border-left-style: solid; border-left-color: #000000; border-right-width: 1px; border-right-style: solid; border-right-color: #000000"></td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="y" style="background-color: #4682B4; border-left-width: 1px; border-left-style: solid; border-left-color: #000000; border-right-width: 1px; border-right-style: solid; border-right-color: #000000"></td>
<td class="gt_row gt_right" headers="x1" style="background-color: #4682B4; border-left-width: 1px; border-left-style: solid; border-left-color: #000000; border-right-width: 1px; border-right-style: solid; border-right-color: #000000"></td>
<td class="gt_row gt_right" headers="x2" style="background-color: #4682B4; border-left-width: 1px; border-left-style: solid; border-left-color: #000000; border-right-width: 1px; border-right-style: solid; border-right-color: #000000"></td>
<td class="gt_row gt_right" headers="x3" style="background-color: #4682B4; border-left-width: 1px; border-left-style: solid; border-left-color: #000000; border-right-width: 1px; border-right-style: solid; border-right-color: #000000"></td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="y" style="background-color: #4682B4; border-left-width: 1px; border-left-style: solid; border-left-color: #000000; border-right-width: 1px; border-right-style: solid; border-right-color: #000000"></td>
<td class="gt_row gt_right" headers="x1" style="background-color: #4682B4; border-left-width: 1px; border-left-style: solid; border-left-color: #000000; border-right-width: 1px; border-right-style: solid; border-right-color: #000000"></td>
<td class="gt_row gt_right" headers="x2" style="background-color: #4682B4; border-left-width: 1px; border-left-style: solid; border-left-color: #000000; border-right-width: 1px; border-right-style: solid; border-right-color: #000000"></td>
<td class="gt_row gt_right" headers="x3" style="background-color: #4682B4; border-left-width: 1px; border-left-style: solid; border-left-color: #000000; border-right-width: 1px; border-right-style: solid; border-right-color: #000000"></td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="y" style="background-color: #4682B4; border-left-width: 1px; border-left-style: solid; border-left-color: #000000; border-right-width: 1px; border-right-style: solid; border-right-color: #000000"></td>
<td class="gt_row gt_right" headers="x1" style="background-color: #4682B4; border-left-width: 1px; border-left-style: solid; border-left-color: #000000; border-right-width: 1px; border-right-style: solid; border-right-color: #000000"></td>
<td class="gt_row gt_right" headers="x2" style="background-color: #4682B4; border-left-width: 1px; border-left-style: solid; border-left-color: #000000; border-right-width: 1px; border-right-style: solid; border-right-color: #000000"></td>
<td class="gt_row gt_right" headers="x3" style="background-color: #4682B4; border-left-width: 1px; border-left-style: solid; border-left-color: #000000; border-right-width: 1px; border-right-style: solid; border-right-color: #000000"></td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="y" style="background-color: #4682B4; border-left-width: 1px; border-left-style: solid; border-left-color: #000000; border-right-width: 1px; border-right-style: solid; border-right-color: #000000"></td>
<td class="gt_row gt_right" headers="x1" style="background-color: #4682B4; border-left-width: 1px; border-left-style: solid; border-left-color: #000000; border-right-width: 1px; border-right-style: solid; border-right-color: #000000"></td>
<td class="gt_row gt_right" headers="x2" style="background-color: #4682B4; border-left-width: 1px; border-left-style: solid; border-left-color: #000000; border-right-width: 1px; border-right-style: solid; border-right-color: #000000"></td>
<td class="gt_row gt_right" headers="x3" style="background-color: #4682B4; border-left-width: 1px; border-left-style: solid; border-left-color: #000000; border-right-width: 1px; border-right-style: solid; border-right-color: #000000"></td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>The original data frame consists of 10 observations. For each observation we have recorded a response variable, <span class="math inline">\(y\)</span>, and three predictors, <span class="math inline">\(x_1, x_2\)</span>, and <span class="math inline">\(x_3\)</span>. If we do an 80-20 split, then 8 of the rows will randomly be assigned to the training set (in blue). The 2 remaining rows (rows 2 and 6) are assigned to the testing set (in gold).</p>
<p>So to recap, our new workflow for predictive modeling involves:</p>
<ol type="1">
<li>Splitting the data into a training and a testing set</li>
<li>Fitting the model to the training set</li>
<li>Evaluating the model using the testing set</li>
</ol>
<section id="more-on-splitting-the-data" class="level3">
<h3 class="anchored" data-anchor-id="more-on-splitting-the-data">More on splitting the data</h3>
<p>As in the diagram above, a standard partition is to dedicate 80% of the observations to the training set and the remainder to the testing set (a 80-20 split), though this is not a rule which is set in stone. The other question is how best to assign the observations to the two sets. In general, it is best to do this <em>randomly</em> to avoid one set that is categorically different than the other.</p>
</section>
<section id="mean-square-error-another-metric-for-evaluation" class="level3">
<h3 class="anchored" data-anchor-id="mean-square-error-another-metric-for-evaluation">Mean square error: another metric for evaluation</h3>
<p>While <span class="math inline">\(R^2\)</span> is the most immediate metric to evaluate the predictive quality of a linear regression, it is quite specific to linear modeling. Therefore, data scientists have come up with another, more general metric called <strong>mean square error (MSE).</strong> Let <span class="math inline">\(y_i\)</span> be observations of the response variable in the testing set, and <span class="math inline">\(\hat{y}_i\)</span> be your model’s predictions for those observations. Then <span class="math inline">\(\text{MSE}\)</span> is given by</p>
<p><span class="math display">\[ \text{MSE} = \frac{1}{n}\sum_{i=1}^n(y_i-\hat{y_i})^2\]</span> You may notice that for a linear regression model, <span class="math inline">\(\text{MSE} = \frac{1}{n}\text{RSS}\)</span>.</p>
<p>A common offshoot is <strong>root mean square error</strong> (<span class="math inline">\(\text{RMSE}\)</span>), which you can obtain by taking the square root of <span class="math inline">\(\text{MSE}\)</span>. Much like what standard deviation does for variance, <span class="math inline">\(\text{RMSE}\)</span> allows you to think above the average error on a regular scale rather than on a squared scale.</p>
</section>
</section>
<section id="the-ideas-in-code" class="level2">
<h2 class="anchored" data-anchor-id="the-ideas-in-code">The Ideas in Code</h2>
<p>Let’s shift the subject to mathematics to biology, and illustrate the training and testing approaching to evaluating predictions for the exam scores from a biology class with 200 students using as a predictor the number of hours that they have studied. Let’s visualize these data first.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="notes_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>Here we are going to compare two models: a simple linear model versus a 5<sup>th</sup> degree polynomial, both fit using the method of least squares.</p>
<ul>
<li><span class="math inline">\(\textbf{Model 1:} \quad \widehat{score} = b_0 + b_1 \times hours\)</span></li>
<li><span class="math inline">\(\textbf{Model 2:} \quad \widehat{score} = b_0 + b_1 \times hours + b_2 \times hours^2 + b_3 \times hours^3 + b_4 \times hours^4 + b_5 \times hours^5\)</span></li>
</ul>
<section id="step-1-split-data" class="level3">
<h3 class="anchored" data-anchor-id="step-1-split-data">Step 1: Split data</h3>
<p>We’ll use an 80-20 split, with each observation assigned to its set randomly. There are many ways to do this via code: here is one using functions we’ve seen.</p>
<ul>
<li>Generate a vector of <span class="math inline">\(n\)</span> observations (in this case, our data has 200 observations) in which <em>approximately</em> 80 percent of the observations are <code>"train"</code> and 20 percent of the observations are <code>"test"</code>. To do this, we can make use of the <code>sample()</code> function.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">20</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>train_or_test <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="st">"train"</span>, <span class="st">"test"</span>), </span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">size =</span> <span class="dv">200</span>, </span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">replace =</span> <span class="cn">TRUE</span>, </span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.8</span>, <span class="fl">0.2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>mutate this vector onto our data frame (our data frame here is called <code>biology</code>). Below, you can see which rows in the data frame have been assigned to <code>"train"</code> and which have been assigned to <code>"test"</code>.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>biology <span class="ot">&lt;-</span> biology <span class="sc">|&gt;</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">set_type =</span> train_or_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 3
  hours score set_type
  &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;   
1  6.30  74.6 test    
2  6.30  73.4 train   
3  7.40  76.6 train   
4  9.97  95.1 test    
5  9.58  82.4 train   
6  8.19  84.0 train   </code></pre>
</div>
</div>
<ul>
<li>split the data based on whether the observations are in the <code>"train"</code> or <code>"test"</code> set.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>biology_train <span class="ot">&lt;-</span> biology <span class="sc">|&gt;</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(set_type <span class="sc">==</span> <span class="st">"train"</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>biology_test <span class="ot">&lt;-</span> biology <span class="sc">|&gt;</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(set_type <span class="sc">==</span> <span class="st">"test"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="step-2-fit-the-model-to-the-training-set" class="level3">
<h3 class="anchored" data-anchor-id="step-2-fit-the-model-to-the-training-set">Step 2: Fit the model to the training set</h3>
<p>Now fit two models on the training data. We will be using <code>lm()</code>, and for both models, the <code>data</code> argument is given by <code>biology_train</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>lm_slr <span class="ot">&lt;-</span> <span class="fu">lm</span>(score <span class="sc">~</span> hours, <span class="at">data =</span> biology_train)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>lm_poly <span class="ot">&lt;-</span> <span class="fu">lm</span>(score <span class="sc">~</span> <span class="fu">poly</span>(hours, <span class="at">degree =</span> <span class="dv">20</span>, <span class="at">raw =</span> T),</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">data =</span> biology_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<!--
Next we visually inspect the predictions.

::: {.cell layout-align="center"}
::: {.cell-output-display}
![](notes_files/figure-html/unnamed-chunk-16-1.png){fig-align='center' width=576}
:::
:::
-->
<p>We can evaluate the <span class="math inline">\(R^2\)</span>’s for both models’ performance on the training data just like before with <code>glance()</code>. Which model do you expect to have a better <em>training</em> set <span class="math inline">\(R^2\)</span> value?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">glance</span>(lm_slr) <span class="sc">%&gt;%</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(r.squared)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 1
  r.squared
      &lt;dbl&gt;
1     0.693</code></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glance</span>(lm_poly) <span class="sc">%&gt;%</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(r.squared)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 1
  r.squared
      &lt;dbl&gt;
1     0.715</code></pre>
</div>
</div>
<p>Just as we might have guessed from looking at the model fits, the polynomial model has a better <span class="math inline">\(R^2\)</span> value when evaluated on the training set.</p>
</section>
<section id="step-3-evaluate-the-model-on-the-testing-set." class="level3">
<h3 class="anchored" data-anchor-id="step-3-evaluate-the-model-on-the-testing-set.">Step 3: Evaluate the model on the testing set.</h3>
<p>The real test of predictive power between the two models comes now, when we will make exam score predictions using the <em>testing</em> set: data which the model was not used to fit and hasn’t seen.</p>
<p>We will still be using the <code>predict()</code> function for this purpose. Now, we can just plug <code>biology_test</code> into the <code>newdata</code> argument!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>score_pred_linear <span class="ot">&lt;-</span> <span class="fu">predict</span>(lm_slr, <span class="at">newdata =</span> biology_test)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>score_pred_poly <span class="ot">&lt;-</span> <span class="fu">predict</span>(lm_poly, <span class="at">newdata =</span> biology_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Once these predictions <span class="math inline">\(\hat{y}_i\)</span> are made, we then can use <code>dplyr</code> code to:</p>
<ul>
<li>mutate on the predictions to our testing data</li>
<li>set up the <span class="math inline">\(R^2\)</span> formula and calculate<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>. In the code below, we are using the formula</li>
</ul>
<p><span class="math display">\[R^2 = 1-\frac{\text{RSS}}{\text{TSS}} = 1-\frac{\sum_{i=1}^n(y_i-\hat{y_i})^2}{\sum_{i=1}^n(y_i-\bar{y})^2}\]</span></p>
<ul>
<li>We can also calculate <span class="math inline">\(\text{MSE}\)</span> and <span class="math inline">\(\text{RMSE}\)</span> as <span class="math inline">\(\frac{1}{n}\text{RSS}\)</span> and <span class="math inline">\(\frac{1}{n}\sqrt{\text{RSS}}\)</span>, respectively.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>biology_test <span class="sc">%&gt;%</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">score_pred_linear =</span> score_pred_linear,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">score_pred_poly =</span> score_pred_poly,</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">resid_sq_linear =</span> (score <span class="sc">-</span> score_pred_linear)<span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">resid_sq_poly =</span> (score <span class="sc">-</span> score_pred_poly)<span class="sc">^</span><span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">TSS =</span> <span class="fu">sum</span>((score <span class="sc">-</span> <span class="fu">mean</span>(score))<span class="sc">^</span><span class="dv">2</span>),</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>              <span class="at">RSS_linear =</span> <span class="fu">sum</span>(resid_sq_linear),</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>              <span class="at">RSS_poly =</span> <span class="fu">sum</span>(resid_sq_poly),</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>              <span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Rsq_linear =</span> <span class="dv">1</span> <span class="sc">-</span> RSS_linear<span class="sc">/</span>TSS,</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>           <span class="at">Rsq_poly =</span> <span class="dv">1</span> <span class="sc">-</span> RSS_poly<span class="sc">/</span>TSS,</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>           <span class="at">MSE_linear =</span> RSS_linear<span class="sc">/</span>n,</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>           <span class="at">MSE_poly =</span> RSS_poly<span class="sc">/</span>n,</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>           <span class="at">RMSE_linear =</span> <span class="fu">sqrt</span>(MSE_linear),</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>           <span class="at">RMSE_poly =</span> <span class="fu">sqrt</span>(MSE_poly)) <span class="sc">|&gt;</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Rsq_linear, Rsq_poly, MSE_linear, MSE_poly)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 4
  Rsq_linear Rsq_poly MSE_linear MSE_poly
       &lt;dbl&gt;    &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt;
1      0.664    0.629       26.6     29.3</code></pre>
</div>
</div>
<p>Voila the linear model’s test set <span class="math inline">\(R^2\)</span> is better than the polynomial model’s test <span class="math inline">\(R^2\)</span>! We also see the <span class="math inline">\(\text{MSE}\)</span> for the linear model is lower than that for the polynomial model.</p>
<p>So which is the better predictive model: Model 1 or Model 2? In terms of training, Model 2 came out of top, but Model 1 won out in testing.</p>
<p>Again, while training <span class="math inline">\(R^2\)</span> can tell us how well a predictive model explains the structure in the data set upon which it was trained, it is deceptive to use as a metric of true predictive accuracy. The task of prediction is fundamentally one applied to unseen data, so testing <span class="math inline">\(R^2\)</span> is the appropriate metric. Model 1, the simpler model, is the better predictive model. After all, the data we are using looks much better modeled by a line than a five degree polynomial.</p>
<!-- ## Hyperparameter tuning -->
<!-- Suppose we want to fit a polynomial model for a dataset; how do we pick the degree? -->
<!-- Selecting the degree of a polynomial model is an example of *hyperparameter tuning*. -->
<!-- It's tempted to fit polynomials for a bunch of degrees -- say every degree between 1 and 10 -- then pick the polynomial with the best $r^2$. -->
<!-- The above sections about overfitting should make us suspicious of this idea; larger degree polynomials will always give better $r^2$ values! -->
<!-- We can use what we learned in the previous train/test set section to select the degree. -->
<!-- In detail, we -->
<!-- 1. split our dataset into a training and test set  -->
<!-- 2. fit each polynomial model on the training set and then  -->
<!-- 3. evaluate each polynomial model on the test set. -->
<!-- This procedure is called *tuning with a validation set*; we conventionally call this test set that gets queried a number of times a *validation set*. -->
<!-- #### Example: Physics Exam Scores -->
<!-- Consider the following physics exam scores dataset where the relationship is no longer linear. -->
<!-- ```{r} -->
<!-- #| fig-align: center -->
<!-- #| fig-width: 5 -->
<!-- #| fig-height: 3 -->
<!-- # Setup data -->
<!-- n_samples_physics <- 20 -->
<!-- set.seed(23) -->
<!-- noise <-  rnorm(n=n_samples_physics, mean=0, sd=2) -->
<!-- physics <- tibble(hours=runif(n=n_samples_physics,  -->
<!--                               min=min_n_hours, -->
<!--                               max=max_n_hours), -->
<!--                   score= (hours - 7.5)^3 + 75 + noise) -->
<!-- physics %>%  -->
<!--     ggplot(aes(x=hours, y=score)) + -->
<!--     geom_point() + -->
<!--     ggtitle("Physics class") + -->
<!--     theme_bw() -->
<!-- ``` -->
<!-- We can select the degree using a train/validation set by fitting 10 different models - each using a different degree - and calculating their $r^2$ for the train and test sets separately. -->
<!-- ```{r} -->
<!-- # In this class the focus is not on the code used in this section, but rather -->
<!-- # how the procedure works. If you are curious about the code, read on... -->
<!-- # Two new programming concepts are used: functions and for loops -->
<!-- ######################### -->
<!-- # Digression: functions # -->
<!-- ######################### -->
<!-- # we have not covered functions yet, but they are pretty straightforward -->
<!-- # the name of the function is the first thing, the word function is special, -->
<!-- # all of the arguments go in the parentheses, and the last line of the function is returned -->
<!-- # Here is a simple example of a function that adds two numbers -->
<!-- add_two_nums <- function(a, b){ -->
<!--     a + b -->
<!-- } -->
<!-- # create a function to return the Rsquared value -->
<!-- get_R_sq <- function(model, test_data, test_y){ -->
<!--     y_pred <- predict(model, newdata=test_data) -->
<!--     TSS = sum((test_y - mean(test_y, na.rm=T))^2, na.rm=T) -->
<!--     RSS = sum((test_y - y_pred)^2, na.rm=T) -->
<!--     1 - RSS / TSS -->
<!-- } -->
<!-- ######################## -->
<!-- # train test set split # -->
<!-- ######################## -->
<!-- # Randomly assign observations to either train or test set -->
<!-- physics <- physics %>%  -->
<!--     mutate(set_type=sample(x=c('train', 'test'), -->
<!--                            size=n_samples_physics, replace=TRUE, prob=c(0.8, 0.2))) -->
<!-- physics_train <- physics %>%  -->
<!--     filter(set_type=='train') -->
<!-- physics_test <- physics %>%  -->
<!--     filter(set_type=='test') -->
<!-- ######################## -->
<!-- # Hyperparemter tuning # -->
<!-- ######################## -->
<!-- degrees2evaluate <- 1:10 -->
<!-- models <- c() -->
<!-- Rsq_values_train <- c() -->
<!-- Rsq_values_test <- c() -->
<!-- # each iteration of this for loop evaluates the model for a different polynomial degree  -->
<!-- for (degree in degrees2evaluate){ -->
<!--     # fit the model on the training data with the specified degree -->
<!--     model <- lm(score~poly(hours, degree=degree, raw=T), data=physics_train) -->
<!--     # compute the R squared value with the train and test data -->
<!--     train_rsq <- get_R_sq(model=model, test_data=physics_train, test_y=physics_train$score) -->
<!--     test_rsq <- get_R_sq(model=model, test_data=physics_test, test_y=physics_test$score) -->
<!--     # save everything -->
<!--     # vector <- c(vector, value) will add the value to the end of the vector -->
<!--     # i.e. c does concatenation -->
<!--     models <- c(models, model) -->
<!--     Rsq_values_train <- c(Rsq_values_train, train_rsq) -->
<!--     Rsq_values_test <- c(Rsq_values_test, test_rsq) -->
<!-- } -->
<!-- # we have not yet learned the gather function -->
<!-- # but you can probably figure out what it does by starting at this code -->
<!-- tuning_results = tibble(degree=degrees2evaluate, -->
<!--                         train = Rsq_values_train, -->
<!--                         test = Rsq_values_test) %>% -->
<!--     gather('type', 'Rsq', -degree) -->
<!-- tuning_results -->
<!-- ``` -->
<!-- Finally let's visualize the results. -->
<!-- ```{r} -->
<!-- #| fig-width: 5 -->
<!-- #| fig-height: 4 -->
<!-- #| fig-align: center -->
<!-- tuning_results %>%  -->
<!--     ggplot(aes(x=degree, y=Rsq, color=type)) +  -->
<!--     geom_point() + -->
<!--     geom_line() +  -->
<!--     scale_x_continuous(breaks=degrees2evaluate) + -->
<!--     theme_bw() -->
<!-- ``` -->
<!-- Taking a look at the numerical results we see degree 3 is the best model, though degrees 4 and 5 seem to work pretty well too. -->
<!-- ```{r} -->
<!-- tuning_results %>%  -->
<!--     filter(type=='test') %>%  -->
<!--     arrange(desc(Rsq)) -->
<!-- ``` -->
</section>
</section>
<section id="summary" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>This lecture is about overfitting: what happens when your model takes the particular data set it was built on too seriously. The more complex a model is, the more prone to overfitting it is. Polynomial models are able to create very complex functions thus high-degree polynomial models can easily overfit. Fitting a model and evaluating it on the same data set can be problematic; if the model is overfitted the evaluation metric (e.g.&nbsp;<span class="math inline">\(R^2\)</span>) might be very good, but the model might be lousy on predictions on new data.</p>
<p>A better way to approach predictive modeling is to fit the model to a training set then evaluate it with a separate testing set.</p>
<div class="page-columns page-full"><p></p><div class="no-row-height column-margin column-container"><span class=""></span></div></div>


</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>We say a function that perfectly predicts each data point <em>interpolates</em> the data. See the first red curve for the math class exams.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Because <span class="math inline">\(\hat{y}_i\)</span> involve information from the training data and <span class="math inline">\(y_i\)</span> and <span class="math inline">\(\bar{y}\)</span> come from the testing data, the decomposition of the sum of squares does not work. So, we cannot interpret testing <span class="math inline">\(R^2\)</span> as we would training <span class="math inline">\(R^2\)</span>, and you may have a testing <span class="math inline">\(R^2\)</span> less than 0. However, higher <span class="math inline">\(R^2\)</span> values still signal that the model has good predictive power.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/stat20\.berkeley\.edu\/fall-2024");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
    <a class="nav-link" href="../../license.html">
<p>License</p>
</a>
  </li>  
</ul>
    </div>
  </div>
</footer>




</body></html>